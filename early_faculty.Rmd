---
title: "Early Career Faculty in GI & Hepatology"
author: "Peter Higgins, RAC Chair"
date: "11/23/2020"
output:
  word_document: 
    reference_docx: "temp.docx"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(janitor)
library(lubridate)
library(glue)
library(ggalt)
library(ragg)
```

## Tracking Junior Faculty and Their Supported Effort

It can become complicated to track which faculty are in the career development phase, and what supported effort they have for research, along the the source for that support, and the timeline for when it runs out. These are important pieces of information for planning and supporting future faculty development and grant applications.

In the Gantt chart below, we will track junior research faculty timelines, with support indicated in:

- red, for Department Support
- gray, for foundation CDAs
- light blue, for internal KL2s
- blue for NIH K awards
- black for NIH R01s

The vertical lines mark:

- red - today - funding should extend past this line - if not, this is an **urgent** problem
- black - 2 years from now - stable funding extends past this line

Anyone whose funding runs out between the 2 lines should actively be **writing and submitting** grants.
```{r data, echo=FALSE, warning=FALSE}
support_levels <- c("Dept Startup", "AASLD CDA", "ACG CDA", "CCF CDA", "NIH KL2", "NIH K23", "NIH K08",  "VA CDA", "VA Other", "NIH U01")

faculty <- read_excel('data/Early Career Fac Apr2023.xlsx',  sheet = 'Sheet1') %>% 
  clean_names() %>% 
  pivot_longer(cols = start_date:end_date,
               names_to = "state",
               values_to = "date") %>% 
  separate(name, c("last_name", "first_name"), sep = ",") %>% 
  mutate(name_support = paste0(last_name, " - ", source_of_support)) %>% 
  mutate(date = ymd(date)) %>% 
  group_by(last_name) %>% 
  arrange(last_name, date) %>% 
  mutate(last_date = last(date)) %>% 
  mutate(source_of_support = factor(source_of_support,
        levels = support_levels)) %>% 
  arrange(last_date, last_name, source_of_support, desc(state)) %>% 
  ungroup() %>% 
  mutate(order_var = 1:nrow(.))

```

## Current Funding

```{r gantt, echo=FALSE, fig.width=9, warning=FALSE, fig.height=6}

faculty %>% 
  group_by(last_name) %>% 
  ggplot(aes(date,  fct_reorder(name_support, desc(order_var)),
             color = source_of_support)) +
  geom_line(size=4) +
  labs(x = "Year", y = NULL, 
       title = "Junior Research Faculty Funding Timelines",
       subtitle = glue("Gastroenterology and Hepatology, N = {length(unique(faculty$last_name))}"),
       color = "Source of Support") +
  geom_vline(xintercept = Sys.Date(), 
             color = "red") +
  scale_color_manual(values = 
      c("red3", "gray80", "gray60", "gray30",
        "skyblue1",  "deepskyblue3", 
        "mediumblue", "darkorchid1", "darkorchid3")) +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  geom_vline(xintercept = ymd(Sys.Date()),
             color = "red") +
  geom_vline(xintercept = ymd(Sys.Date()) + 730,
             color = "black") +
  annotate("text", label = "Today", size = 3,
           x = ymd(Sys.Date())-155, 
           y = nrow(faculty)/2, color = "red") +
  annotate("text", label = "Write/Submit\nGrants", 
           x = ymd(Sys.Date()) + 365, size = 3,
           y = nrow(faculty)/2-0.5, 
           color = "blue") +
  annotate("text", label = "2 years from now", 
           x = ymd(Sys.Date()) + 1110, size = 3,
           y = nrow(faculty)/2, color = "black") +
  geom_rect(xmin = ymd(Sys.Date())+ 1380, 
            xmax = ymd(Sys.Date())+ 1830, , 
            ymin = 19, ymax = 23.5, 
            color = "blue", fill = "white") +
  annotate("text", label = "5 Faculty Transitioned \nto Independent Funding", size = 3.5,
           x = ymd(Sys.Date())+ 1505, 
           y = nrow(faculty)/2-18, color = "black") +
  annotate("text", label = "Parikh\nStidham\nTapper\nAdams\nMellinger", size = 3,
           x = ymd(Sys.Date())+ 1605, 
           y = nrow(faculty)/2-22, color = "black") +
    theme_minimal() +
  theme(panel.background = element_rect(fill = "grey97", colour = NA),
    plot.background = element_rect(fill = "grey97", colour = NA )) +
  theme(plot.title = element_text(face = "bold.italic"),
        legend.position = c(0.89, 0.77),
        axis.text = element_text(color = "black"),
        legend.background = element_rect(fill = "gray97",
    color = "steelblue")) ->
plot

plot 

ggsave("gantt.png", device = "png", 
       units = "in", dpi = 320,
       width = 18, height = 9)
```

## Planned Grant Proposals

```{r proposals, echo=FALSE, warning = FALSE, fig.width=9, fig.height=6}

proposals <- read_excel('data/RAC_Info Update Jun2021.xlsx') %>% 
  clean_names() %>% 
  select(name, primary_mentor, current_title:date_of_funding) %>% 
  separate(name, c("first_name", "last_name"), sep = " ") %>% 
  mutate(name_grant = paste0(last_name, " - ", grant_proposal)) %>% 
  mutate(date_asst_prof = ymd(date_asst_prof)) %>% 
  mutate(date_of_submission = ymd(date_of_submission)) %>% 
  mutate(date_of_funding = ymd(date_of_funding)) %>% 
  group_by(last_name) %>% 
  arrange(last_name, date_of_funding) %>% 
  mutate(first_funding = first(date_of_funding)) %>% 
  arrange(last_name, first_funding, date_of_funding) %>% 
  ungroup() %>% 
  mutate(order_var = 1:nrow(.)) %>% 
  mutate(date_of_funding = date_of_submission + 550)

proposals %>% 
  group_by(last_name) %>% 
  arrange(last_name, date_of_funding) %>% 
  ggplot(aes(y = fct_reorder(name_grant, desc(order_var)),
             x=date_of_submission, xend=date_of_funding)) +
  geom_dumbbell(size=1.5, color="#b2b2b2", 
                size_x=3, size_xend = 3, colour_x = "deepskyblue3", colour_xend = "forestgreen") +
  annotate("text", label = "Submit date", size = 3,
           x = ymd(Sys.Date()) - 520, 
           y = nrow(proposals) - 0.5, color = "deepskyblue3") +
  annotate("text", label = "Funding date", size = 3,
           x = ymd(Sys.Date()) + 280, 
           y = nrow(proposals) - 0.5, color = "forestgreen") +
  geom_vline(xintercept = ymd(Sys.Date()),
             color = "red") +
  annotate("text", label = "Today", size = 3,
           x = ymd(Sys.Date()) - 30, 
           y = nrow(proposals) - 0.5, color = "red") +
  geom_text(aes(y = fct_reorder(name_grant, desc(order_var)),
             label = primary_mentor, x = Sys.Date() + 1440), size = 2.2) +
  theme_minimal() +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  labs(x = "Year", y = NULL, 
       title = "Junior Faculty Research Grant Application Timelines",
       subtitle = glue("Gastroenterology and Hepatology, N = {length(unique(proposals$last_name))}                                                                   Primary Mentor")) +
  theme(plot.title = element_text(face = "bold.italic"),
        legend.position = c(0.80, 0.7),
        axis.text = element_text(color = "black"))

ggsave("proposals.png", device = "png", units = "in", dpi = 320,
       width = 18, height = 9)
# use 9 x 7 for printouts
```
